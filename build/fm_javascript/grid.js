var store,storeExporter,grid,gridExporter,datos,datosExporter;var gridMemory={memory:[],};function iniciarGrid(){datos={items:[]};datosExporter={items:[]};grid=new dojox.grid.EnhancedGrid({escapeHTMLInData:false,plugins:{pagination:{description:true,sizeSwitch:false,pageStepper:true,gotoButton:true,maxPageStep:4,position:"top",defaultPageSize:25},indirectSelection:{width:"0",styles:"text-align: center;"}},onSelected:markSelected,onDeselected:markSelected},dojo.create("div",{},dojo.byId("fm_results")));grid.startup();dojo.connect(window,"onresize",function(){grid.resize();grid.update()});gridExporter=new dojox.grid.EnhancedGrid({plugins:{exporter:true}})}function hacerZoom(b,a){map.graphics.clear();point=new esri.geometry.Point(b,a,new esri.SpatialReference({wkid:5373}));point=esri.geometry.geographicToWebMercator(point);graphic=new esri.Graphic(point,new esri.symbol.PictureMarkerSymbol("images/i_target.png",38,38));map.graphics.add(graphic);map.centerAndZoom(point,14)}function exportarTodo(){gridExporter.exportGrid("csv",function(a){})}function prevGrid(){console.log(gridMemory);if(gridMemory.selectedIndex-1>=0){grid.setStructure(gridMemory.memory[gridMemory.selectedIndex-1].layout);grid.setStore(gridMemory.memory[gridMemory.selectedIndex-1].store);gridExporter.setStructure(gridMemory.memory[gridMemory.selectedIndex-1].layoutExporter);gridExporter.setStore(gridMemory.memory[gridMemory.selectedIndex-1].storeExporter);gridExporter.exportGrid("csv",function(a){console.log(a);dojo.byId("csv").value=a});gridMemory.selectedIndex--}}function nextGrid(){console.log(gridMemory);if(gridMemory.selectedIndex+1<gridMemory.memory.length){grid.setStructure(gridMemory.memory[gridMemory.selectedIndex+1].layout);grid.setStore(gridMemory.memory[gridMemory.selectedIndex+1].store);gridExporter.setStructure(gridMemory.memory[gridMemory.selectedIndex+1].layoutExporter);gridExporter.setStore(gridMemory.memory[gridMemory.selectedIndex+1].storeExporter);gridExporter.exportGrid("csv",function(a){console.log(a);dojo.byId("csv").value=a});gridMemory.selectedIndex++}}function selectAllCallback(a){console.log(a);if(a==true){grid.selection.selectRange(0,grid.scroller.rowCount-1)}else{grid.selection.deselectAll()}}function markSelected(){map.graphics.clear();rowsSelected=grid.selection.getSelected();if(rowsSelected.length!=0){gridExporter.selection.deselectAll();dojo.forEach(rowsSelected,function(a){gridExporter.selection.addToSelection(a._0)});points=dojo.map(gridExporter.selection.getSelected(),function(a){return[a.longitud[0],a.latitud[0]]});mpJson={points:points,spatialReference:({" wkid":5373})};multipoint=esri.geometry.geographicToWebMercator(new esri.geometry.Multipoint(mpJson));graphic=new esri.Graphic(multipoint,new esri.symbol.PictureMarkerSymbol("images/i_target.png",38,38));map.graphics.add(graphic);map.setExtent(multipoint.getExtent(),true)}};