dojo.require("esri.dijit.Measurement");dojo.require("esri.dijit.Scalebar");dojo.require("esri.map");dojo.require("agsjs.layers.GoogleMapsLayer");dojo.require("agsjs.dijit.TOC");dojo.require("dojo.fx");dojo.require("esri.dijit.OverviewMap");dojo.require("esri.layers.FeatureLayer");dojo.require("esri.tasks.query");dojo.require("dojox.grid.EnhancedGrid");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dojox.grid.enhanced.plugins.exporter.CSVWriter");dojo.require("esri.dijit.Print");dojo.require("dijit.Toolbar");dojo.require("esri.toolbars.draw");dojo.require("esri.toolbars.Navigation");var map;var currentBasemap;var identifyTask,identifyParams;var initExtent;var measurement;function init(){initExtent=new esri.geometry.Extent({xmin:-9052049.2735,ymin:-2078120.579,xmax:-7643108.7015,ymax:-10153.778299998492,spatialReference:{wkid:102100}});map=new esri.Map("map",{extent:initExtent,wrapAround180:true,sliderStyle:"small",logo:false,});createBasemapGallery();centros_poblados=new esri.layers.ArcGISDynamicMapServiceLayer("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/cp/MapServer");map.addLayer(centros_poblados);limites_politicos=new esri.layers.ArcGISTiledMapServiceLayer("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/pol/MapServer");ie=new esri.layers.ArcGISDynamicMapServiceLayer("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/ie/MapServer");var b=new agsjs.dijit.TOC({map:map,layerInfos:[{layer:centros_poblados,title:"Centros Poblados"},{layer:limites_politicos,title:"Límites Políticos"},{layer:ie,title:"Instituciones Educativas"}]},"toc");b.startup();osml=new esri.layers.OpenStreetMapLayer();var a=new esri.dijit.OverviewMap({map:map,baseLayer:osml,height:0.25*map.height,width:0.25*map.width});a.startup();llenarFormulario();dojo.connect(dojo.byId("buscar"),"onclick",busqueda);dojo.connect(window,"onresize",function(){if(map){map.resize()}});inicializarGrid();iniciarIdentify();iniciarNavegacion();onMapLoaded();desactivarCargando();dojo.style("cargando","opacity",0.5)}function createBasemapGallery(){var b=[];b.push(new esri.dijit.Basemap({layers:[new esri.dijit.BasemapLayer({type:"GoogleMapsRoad"})],title:"Google Road",id:"GoogleRoad",thumbnailUrl:dojo.moduleUrl("agsjs.dijit","images/googleroad.png")}));b.push(new esri.dijit.Basemap({layers:[new esri.dijit.BasemapLayer({type:"GoogleMapsSatellite"})],title:"Google Satellite",id:"GoogleSatellite",thumbnailUrl:dojo.moduleUrl("agsjs.dijit","images/googlesatellite.png")}));b.push(new esri.dijit.Basemap({layers:[new esri.dijit.BasemapLayer({type:"GoogleMapsHybrid"})],title:"Google Hybrid",id:"GoogleHybrid",thumbnailUrl:dojo.moduleUrl("agsjs.dijit","images/googlehybrid.png")}));b.push(new esri.dijit.Basemap({layers:[new esri.dijit.BasemapLayer({type:"OpenStreetMap"})],title:"OpenStreet",id:"OpenStreetMap",thumbnailUrl:"images/bm-street.jpg"}));var a=new esri.dijit.BasemapGallery({showArcGISBasemaps:false,basemaps:b,google:{apiOptions:{v:"3.6"},mapOptions:{streetViewControl:false}},map:map},"basemapList");a.startup();a.select("GoogleHybrid");dojo.connect(a,"onError",function(c){if(console){console.log(c)}})}function onMapLoaded(){console.log("map loaded enter");var a=new esri.dijit.Scalebar({map:map,attachTo:"bottom-left",scalebarUnit:"metric"});measurement=new esri.dijit.Measurement({map:map,defaultAreaUnit:esri.Units.SQUARE_KILOMETERS,defaultLengthUnit:esri.Units.KILOMETERS},dojo.byId("measurementDiv"));measurement.startup();dojo.connect(map,"onMouseMove",res.showCoords);res.showCoords(map.extent.getCenter());dojo.connect(map,"onExtentChange",onMapExtentChange);onMapExtentChange();console.log("map loaded exit")}function onMapExtentChange(){var a=Math.round(esri.geometry.getScale(map));if(a>999&&a<=999999){a=Math.round(a/1000)+" <b>K</b>"}else{if(a>999999){a=Math.round(a/1000000)+" <b>M</b>"}else{if(a>0&&a<=999){a=Math.round(a)+" <b>Ft</b>"}}}res.updateScaleInfo(a,map.getLevel())}function activarCargando(){dojo.style("cargando","display","block")}function desactivarCargando(){dojo.style("cargando","display","none")}window.onorientationchange=function(){if(map){map.resize()}else{console.log("map not found")}};window.onresize=function(){if(map){map.resize()}else{console.log("map not found")}};dojo.ready(init);