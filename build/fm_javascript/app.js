function busqueda(b){if(b){dojo.stopEvent(b)}var a=dijit.byId("searchForm");if(!isBlank(a)){if(a.validate()){activarCargando();processSearch(a)}else{alert("Alguno de los datos no es válido.")}}else{alert("El formulario no puede estar en blanco.")}}function processSearch(b){var c=b.getValues().ubigeo;var o=b.getValues().nombre_iiee;var f=b.getValues().codigo_modular;var i=b.getValues().codigo_local;var h=b.getValues().nombre_ccpp1;var a=b.getValues().localidad;var e=b.getValues().nivel_modalidad===null?"":b.getValues().nivel_modalidad;var n=b.getValues().gestion===null?"":b.getValues().gestion;var g=b.getValues().nombre_ccpp2;var l=b.getValues().codigo_ccpp1;var j=b.getValues().codigo_ccpp2;var m=b.getValues().codigo_ugel;var k={url:"http://escale.minedu.gob.pe/mapaeducativolenguas/restservicesig/service/restsig.svc/padron",handleAs:"json",content:{codgeo:c,codugel:m,codmod:f,anexo:"",nombreie:o,codlocal:i,direccion:"",cenpob:h,localidad:a,nivmod:e,gesdep:n,codcp:l},load:processFormIE,error:function(p){desactivarCargando();alert("Un error inesperado a ocurrido: "+p)}};var d={url:"http://escale.minedu.gob.pe/mapaeducativolenguas/restservicesig/service/restsig.svc/ccpp",handleAs:"json",content:{ubigeo:c,codcp:j,codugel:m,nomcp:g,ubicado:"",area:"",fuentecp:""},load:processFormCP,error:function(p){desactivarCargando();alert("Un error inesperado a ocurrido: "+p)}};if(dijit.byId("tabs2").selectedChildWidget.title=="Padrón II.EE."){deferred=dojo.xhrGet(k)}if(dijit.byId("tabs2").selectedChildWidget.title=="Centros Poblados"){deferred=dojo.xhrGet(d)}}function processFormIE(b){var a=dojo.json.parse(b);datos={items:[]};layout=[[{name:"Ubigeo",field:"ubigeo"}],[{name:"Departamento",field:"departamento"}],[{name:"Provincia",field:"provincia"}],[{name:"Distrito",field:"distrito"}],[{name:"Nombre del Centro Poblado",field:"nombre_del_centro_poblado"}],[{name:"Código del Centro Poblado",field:"codigo_del_centro_poblado"}],[{name:"Localidad",field:"localidad"}],[{name:"Código Local",field:"codigo_local"}],[{name:"Código Modular",field:"codigo_modular"}],[{name:"Nombre IE",field:"nombre_ie"}],[{name:"Nivel",field:"nivel"}],[{name:"Altitud",field:"altitud"}],[{name:"Fuente CP",field:"fuente_cp"}],[{name:"Latitud",field:"latitud",hidden:true}],[{name:"Longitud",field:"longitud",hidden:true}],[{name:"Enlaces",field:"enlaces"}]];datosExporter={items:[]};layoutExporter=[[{name:"Ubigeo",field:"ubigeo"},{name:"Departamento",field:"departamento"},{name:"Provincia",field:"provincia"},{name:"Distrito",field:"distrito"},{name:"Nombre del Centro Poblado",field:"nombre_del_centro_poblado"},{name:"Código del Centro Poblado",field:"codigo_del_centro_poblado"},{name:"Localidad",field:"localidad"},{name:"Código Local",field:"codigo_local"},{name:"Código Modular",field:"codigo_modular"},{name:"Nombre IE",field:"nombre_ie"},{name:"Nivel",field:"nivel"},{name:"Altitud",field:"altitud"},{name:"Fuente CP",field:"fuente_cp"},{name:"Latitud",field:"latitud"},{name:"Longitud",field:"longitud"}]];console.log("Se declaró los layouts.");dojo.forEach(a.Rows,function(c){if(c.ESTADO==="1"){items={ubigeo:"Ubigeo: "+c.CODIGO_UBIGEO,departamento:"Departamento: "+c.DEPARTAMENTO,provincia:"Provincia: "+c.PROVINCIA,distrito:"Distrito: "+c.DISTRITO,nombre_del_centro_poblado:"Centro Poblado: "+c.NOMBRE_CENTRO_POBLADO,codigo_del_centro_poblado:"Código del Centro Poblado: "+c.COD_CENTRO_POBLADO,localidad:c.NOMBRE_LOCALIDAD?"Localidad: "+c.NOMBRE_LOCALIDAD:"Localidad: ",codigo_local:"Código Local: "+c.CODIGO_LOCAL,codigo_modular:"Código Modular: "+c.CODIGO_MODULAR,nombre_ie:"Nombre de la IE: "+c.NOMBRE_ESCUELA,nivel:"Nivel: "+c.NIVEL_MODALIDAD,altitud:"Altitud: "+c.ALTITUD,fuente_cp:c.ALTITUD?"Fuente CP: "+c.FUENTECP:"Fuente CP: ",latitud:"Latitud: "+c.LATITUD_DEC,longitud:"Longitud: "+c.LONGITUD_DEC,enlaces:"<a class='img-enlaces' onclick='hacerZoom("+c.LONGITUD_DEC+","+c.LATITUD_DEC+");'><img src='images/zoom.png'></a><a class='img-enlaces' onclick='irAFicha(\""+c.CODIGO_MODULAR+'","'+c.ANEXO+"\");'><img src='images/ficha.png'></a>"};itemsExporter={ubigeo:c.CODIGO_UBIGEO,departamento:c.DEPARTAMENTO,provincia:c.PROVINCIA,distrito:c.DISTRITO,nombre_del_centro_poblado:c.NOMBRE_CENTRO_POBLADO,codigo_del_centro_poblado:c.COD_CENTRO_POBLADO,localidad:c.NOMBRE_LOCALIDAD,codigo_local:c.CODIGO_LOCAL,codigo_modular:c.CODIGO_MODULAR,nombre_ie:c.NOMBRE_ESCUELA,nivel:c.NIVEL_MODALIDAD,altitud:c.ALTITUD,fuente_cp:c.FUENTECP,latitud:c.LATITUD_DEC,longitud:c.LONGITUD_DEC};datos.items.push(items);datosExporter.items.push(itemsExporter)}});store=new dojo.data.ItemFileWriteStore({data:datos});dijit.byId("selectAll").setChecked(false);grid.onStyleRow=styleRowIE;grid.setStructure(layout);grid.setStore(store);console.log("Store agregado a grid");storeExporter=new dojo.data.ItemFileWriteStore({data:datosExporter});gridExporter.setStructure(layoutExporter);gridExporter.setStore(storeExporter);console.log("Store agregado a gridExporter");gridMemory.memory.push({store:store,storeExporter:storeExporter,layout:layout,layoutExporter:layoutExporter,type:"ie"});gridMemory.selectedIndex=gridMemory.memory.length-1;dojo.query(".fm_button").removeClass("fm_button_active");dojo.query(".fm_results_trigger").addClass("fm_button_active");dojo.query(".fm_panel").style("display","none");dojo.query(".fm_results").style("display","block");dojo.query(".dojoxGridRowOdd").style({background:"red"});desactivarCargando()}function processFormCP(b){var a=dojo.json.parse(b);console.log(a);datos={items:[]};layout=[[{name:"Ubigeo",field:"ubigeo"}],[{name:"Departamento",field:"departamento"}],[{name:"Provincia",field:"provincia"}],[{name:"Distrito",field:"distrito"}],[{name:"Código del Centro Poblado",field:"codigo_del_centro_poblado"}],[{name:"Nombre del Centro Poblado",field:"nombre_del_centro_poblado"}],[{name:"¿Tiene institución educativa?",field:"con_iiee"}],[{name:"Número de Instituciones Educativas",field:"numero_de_iiee"}],[{name:"Nivel",field:"nivel"}],[{name:"¿Es capital?",field:"capital"}],[{name:"Fuente CP",field:"fuente_cp"}],[{name:"Altitud",field:"altitud"}],[{name:"Latitud",field:"latitud",hidden:true}],[{name:"Longitud",field:"longitud",hidden:true}],[{name:"Enlaces",field:"enlaces"}]];datosExporter={items:[]};layoutExporter=[[{name:"Ubigeo",field:"ubigeo"},{name:"Departamento",field:"departamento"},{name:"Provincia",field:"provincia"},{name:"Distrito",field:"distrito"},{name:"Código del Centro Poblado",field:"codigo_del_centro_poblado"},{name:"Nombre del Centro Poblado",field:"nombre_del_centro_poblado"},{name:"¿Tiene institución educativa?",field:"con_iiee"},{name:"Número de Instituciones Educativas",field:"numero_de_iiee"},{name:"Nivel",field:"nivel"},{name:"¿Es capital?",field:"capital"},{name:"Fuente CP",field:"fuente_cp"},{name:"Altitud",field:"altitud"},{name:"Latitud",field:"latitud"},{name:"Longitud",field:"longitud"}]];dojo.forEach(a.Rows,function(c){items={ubigeo:"Ubigeo: "+c.UBIGEO,departamento:"Departamento: "+c.DEPARTAMENTO,provincia:"Provincia: "+c.PROVINCIA,distrito:"Distrito: "+c.DISTRITO,codigo_del_centro_poblado:"Código del Centro Poblado: "+c.CODCP,nombre_del_centro_poblado:"Centro Poblado: "+c.DENOMINACION,con_iiee:"¿Tiene IE?: "+c.CON_IE,numero_de_iiee:"Número de Instituciones Educativas: "+c.N_IIEE,nivel:"Nivel: "+c.NIVEL,capital:"¿Es capital?: "+c.CAPITAL,fuente_cp:"Fuente CP: "+c.FUENTE_SIG,altitud:"Altitud: "+c.ALT_CP,latitud:"Latitud: "+c.LATITUD_DEC,longitud:"Longitud: "+c.LONGITUD_DEC,enlaces:"<a class='img-enlaces' onclick='hacerZoom("+c.LONGITUD_DEC+","+c.LATITUD_DEC+");'><img src='images/zoom.png'></a><a class='img-enlaces' onclick='irAIE("+c.CODCP+")'><img src='images/ficha.png'></a>"};itemsExporter={ubigeo:c.UBIGEO,departamento:c.DEPARTAMENTO,provincia:c.PROVINCIA,distrito:c.DISTRITO,codigo_del_centro_poblado:c.CODCP,nombre_del_centro_poblado:c.DENOMINACION,con_iiee:c.CON_IE,numero_de_iiee:c.N_IIEE,nivel:c.NIVEL,capital:c.CAPITAL,fuente_cp:c.FUENTE_SIG,altitud:c.ALT_CP,latitud:c.LATITUD_DEC,longitud:c.LONGITUD_DEC};datos.items.push(items);datosExporter.items.push(itemsExporter)});store=new dojo.data.ItemFileWriteStore({data:datos});dijit.byId("selectAll").setChecked(false);grid.onStyleRow=styleRowCP;grid.setStructure(layout);grid.setStore(store);storeExporter=new dojo.data.ItemFileWriteStore({data:datosExporter});gridExporter.setStructure(layoutExporter);gridExporter.setStore(storeExporter);gridMemory.memory.push({store:store,storeExporter:storeExporter,layout:layout,layoutExporter:layoutExporter,type:"cp"});gridMemory.selectedIndex=gridMemory.memory.length-1;dojo.query(".fm_button").removeClass("fm_button_active");dojo.query(".fm_results_trigger").addClass("fm_button_active");dojo.query(".fm_panel").style("display","none");dojo.query(".fm_results").style("display","block");desactivarCargando()}function irAFicha(b,a){console.log(b);console.log(a);window.open("http://escale.minedu.gob.pe/PadronWeb/info/ce?cod_mod="+b+"&anexo="+a)}function irAIE(a){searchForm=dijit.byId("searchForm");tabs2=dijit.byId("tabs2");searchPrevValues=searchForm.getValues();tabs2PrevChild=tabs2.selectedChildWidget;searchForm.reset();newValues=searchForm.getValues();newValues.codigo_ccpp1=String(a);searchForm.setValues(newValues);tabs2.selectChild(tabs2.getChildren()[0]);busqueda();searchForm.reset();searchForm.setValues(searchPrevValues);tabs2.selectChild(tabs2PrevChild)}function isBlank(b){var c=b.getValues().ubigeo;var m=b.getValues().nombre_iiee;var e=b.getValues().codigo_modular;var h=b.getValues().codigo_local;var g=b.getValues().nombre_ccpp1;var a=b.getValues().localidad;var d=b.getValues().nivel_modalidad===null?"":b.getValues().nivel_modalidad;var l=b.getValues().gestion===null?"":b.getValues().gestion;var f=b.getValues().nombre_ccpp2;var j=b.getValues().codigo_ccpp1;var i=b.getValues().codigo_ccpp2;var k=b.getValues().codigo_ugel;if(c===""&&m===""&&e===""&&h===""&&g===""&&a===""&&d===""&&l===""&&f===""&&j===""&&i===""&&k===""){return true}else{return false}}function styleRowIE(a){console.log(a);if(a.index%2!==0){a.customStyles+="background: #EBC97A;"}if(a.over){a.customStyles+="background: #7FC5EB"}}function styleRowCP(a){console.log(a);if(a.index%2!==0){a.customStyles+="background: #9CEB94;"}if(a.over){a.customStyles+="background: #7FC5EB"}}function initCustom(){dojo.declare("custom.EnhancedGrid",dojox.grid.EnhancedGrid,{onDeselectedAll:function(){}})}function exportGrid(){gridExporter.exportGrid("csv",function(a){dojo.byId("csv").value=a;dijit.byId("exportador").submit()})}function llenarFormulario(){var c=dijit.byId("departamento");var e=dijit.byId("provincia");var d=dijit.byId("distrito");var f=dijit.byId("ubigeo");var g=dijit.byId("nivel_modalidad");var i=dijit.byId("gestion");var a=dijit.byId("direccion_regional");var b=dijit.byId("ugel");var h=dijit.byId("codigo_ugel");require(["esri/tasks/query"],function(){depQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer/1");depQuery=new esri.tasks.Query();depQuery.where="1=1";depQuery.returnGeometry=false;depQuery.outFields=["IDDPTO","NOMBDEP"];depQueryTask.execute(depQuery,function(k){var l=[];var j=[];dojo.forEach(k.features,function(m){l.push({value:m.attributes.IDDPTO,label:m.attributes.NOMBDEP});j.push({value:m.attributes.IDDPTO,label:m.attributes.NOMBDEP})});c.addOption(l);a.addOption(j)})});dojo.connect(c,"onChange",function(j){console.log("Departamento cambió.");console.log(j);if(j&&j!==""){console.log("Estoy ejecutando peticiones.");onDepartamentoChange(f,c,e,d,j)}else{e.removeOption(e.getOptions());e.addOption({label:":: Seleccione ::",value:""});e.setValue("");d.removeOption(d.getOptions());d.addOption({label:":: Seleccione ::",value:""});d.setValue("")}});dojo.connect(e,"onChange",function(j){console.log("Provincia cambió.");console.log(j);if(j&&j!==""){onProvinciaChange(f,c,e,d,j)}else{d.removeOption(d.getOptions());d.addOption({label:":: Seleccione ::",value:""});d.setValue("")}});dojo.connect(d,"onChange",function(j){console.log("Distrito cambió.");console.log(j);if(d.value!==""){require(["esri/tasks/query"],function(){distGeometryQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer/3");distGeometryQuery=new esri.tasks.Query();distGeometryQuery.where="IDDIST='"+j+"'";distGeometryQuery.returnGeometry=true;distGeometryQuery.outFields=[];distGeometryQueryTask.execute(distGeometryQuery,function(k){console.log(k);feature=k.features[0];centrarExtent(feature.geometry.getExtent())})});f.set("value",d.value)}else{f.set("value",e.value)}});dojo.connect(a,"onChange",function(j){if(j&&j!==""){onDireccionRegionalChange(h,a,b,j)}else{b.removeOption(b.getOptions());b.addOption({label:":: Seleccione ::",value:""})}});dojo.connect(b,"onChange",function(j){if(b.value!==""){require(["esri/tasks/query"],function(){ugelGeometryQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/ugel/MapServer/1");ugelGeometryQuery=new esri.tasks.Query();ugelGeometryQuery.where="CODUGEL='"+j+"'";ugelGeometryQuery.returnGeometry=true;ugelGeometryQuery.outFields=[];ugelGeometryQueryTask.execute(ugelGeometryQuery,function(k){feature=k.features[0];centrarExtent(feature.geometry.getExtent())})});h.set("value",b.value)}else{h.set("value",a.value)}});nivelOptions=[];nivelOptions.push({label:"Inicial",value:"A1|A2|A3"});nivelOptions.push({label:"Programa",value:"A5"});nivelOptions.push({label:"Primaria EBR",value:"B0"});nivelOptions.push({label:"Secundaria EBR",value:"F0"});nivelOptions.push({label:"Primaria EDA",value:"C0"});nivelOptions.push({label:"Secundaria EDA",value:"G0"});nivelOptions.push({label:"Básica alternativa",value:"D0"});nivelOptions.push({label:"Superior no universitaria",value:"K0|T0|M0"});nivelOptions.push({label:"Especial",value:"E0"});nivelOptions.push({label:"CETPRO",value:"L0"});g.addOption(nivelOptions);gestionOptions=[];gestionOptions.push({label:"Ministerio de Educación",value:"A1"});gestionOptions.push({label:"Otro sector público (FF.AA)",value:"A2"});gestionOptions.push({label:"Municipalidad",value:"A3"});gestionOptions.push({label:"Nacionales en convenio",value:"A4"});gestionOptions.push({label:"Cooperativo",value:"B1"});gestionOptions.push({label:"Comunidad o asociación religiosa",value:"B2"});gestionOptions.push({label:"Comunidad",value:"B3"});gestionOptions.push({label:"Particular",value:"B4"});gestionOptions.push({label:"Empresa",value:"B5"});gestionOptions.push({label:"Asociación civil / Institución benéfica",value:"B6"});i.addOption(gestionOptions);dojo.connect(dojo.query(".fm_find_trigger")[0],"onclick",function(){dijit.byId("tabs1").resize();dijit.byId("tabs2").resize()})}function centrarExtent(a){map.setExtent(a)}function onDepartamentoChange(a,d,e,c,b){require(["esri/tasks/query"],function(){depGeometryQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer/1");depGeometryQuery=new esri.tasks.Query();depGeometryQuery.where="IDDPTO='"+b+"'";depGeometryQuery.returnGeometry=true;depGeometryQuery.outFields=[];depGeometryQueryTask.execute(depGeometryQuery,function(f){feature=f.features[0];centrarExtent(feature.geometry.getExtent())})});a.set("value",d.value);e.removeOption(e.getOptions());e.addOption({label:":: Seleccione ::",value:""});c.removeOption(c.getOptions());c.addOption({label:":: Seleccione ::",value:""});require(["esri/tasks/query"],function(){provQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer/2");provQuery=new esri.tasks.Query();provQuery.where="IDPROV LIKE '"+d.value+"%'";provQuery.returnGeometry=false;provQuery.outFields=["IDPROV","NOMBPROV"];provQueryTask.execute(provQuery,function(g){var f=[];dojo.forEach(g.features,function(h){f.push({value:h.attributes.IDPROV,label:h.attributes.NOMBPROV})});e.addOption(f)})})}function onProvinciaChange(a,d,e,c,b){require(["esri/tasks/query"],function(){provGeometryQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer/2");provGeometryQuery=new esri.tasks.Query();provGeometryQuery.where="IDPROV='"+b+"'";provGeometryQuery.returnGeometry=true;provGeometryQuery.outFields=[];provGeometryQueryTask.execute(depGeometryQuery,function(f){feature=f.features[0];centrarExtent(feature.geometry.getExtent())})});if(e.value!==""){a.set("value",e.value)}else{a.set("value",d.value)}c.removeOption(c.getOptions());c.addOption({label:":: Seleccione ::",value:""});require(["esri/tasks/query"],function(){distQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer/3");distQuery=new esri.tasks.Query();distQuery.where="IDPROV LIKE '"+e.value+"%'";distQuery.returnGeometry=false;distQuery.outFields=["IDDIST","NOMBDIST"];distQueryTask.execute(distQuery,function(f){var g=[];dojo.forEach(f.features,function(h){g.push({value:h.attributes.IDDIST,label:h.attributes.NOMBDIST})});c.addOption(g)})})}function onDireccionRegionalChange(d,c,a,b){require(["esri/tasks/query"],function(){direccionGeometryQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer/2");direccionGeometryQuery=new esri.tasks.Query();direccionGeometryQuery.where="IDDPTO='"+b+"'";direccionGeometryQuery.returnGeometry=true;direccionGeometryQuery.outFields=[];direccionGeometryQueryTask.execute(direccionGeometryQuery,function(e){feature=e.features[0];centrarExtent(feature.geometry.getExtent())})});d.set("value",c.value);a.removeOption(a.getOptions());a.addOption({label:":: Seleccione ::",value:""});require(["esri/tasks/query"],function(){ugelQueryTask=new esri.tasks.QueryTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/ugel/MapServer/1");ugelQuery=new esri.tasks.Query();ugelQuery.where="CODUGEL LIKE '"+c.value+"%'";ugelQuery.returnGeometry=false;ugelQuery.outFields=["CODUGEL","UGEL"];ugelQueryTask.execute(ugelQuery,function(f){var e=[];dojo.forEach(f.features,function(g){e.push({value:g.attributes.CODUGEL,label:g.attributes.UGEL})});a.addOption(e)})})}var grid,gridExporter;var gridMemory={memory:[]};function iniciarGrid(){datos={items:[]};datosExporter={items:[]};grid=new dojox.grid.EnhancedGrid({escapeHTMLInData:false,plugins:{pagination:{id:"gridPaginator",description:true,sizeSwitch:false,pageStepper:true,gotoButton:true,maxPageStep:4,position:"top",defaultPageSize:25,onPageStep:function(){grid.selection.clear()}},indirectSelection:{width:"5px",styles:"text-align: center;"}},onSelectionChanged:markSelected},dojo.create("div",{},dojo.byId("fm_results")));grid.startup();dojo.connect(window,"onresize",function(){grid.resize();grid.update()});gridExporter=new dojox.grid.EnhancedGrid({plugins:{exporter:true}})}function hacerZoom(b,a){if(b!=="-80"&&a!=="-10"){map.graphics.clear();point=new esri.geometry.Point(b,a,new esri.SpatialReference({wkid:5373}));point=esri.geometry.geographicToWebMercator(point);graphic=new esri.Graphic(point,new esri.symbol.PictureMarkerSymbol("images/i_target.png",38,38));map.graphics.add(graphic);map.centerAndZoom(point,14)}else{alert("El Centro Poblado o Institución Educativa no está ubicado.")}}function exportarTodo(){gridExporter.exportGrid("csv",function(a){})}function prevGrid(){console.log(gridMemory);map.graphics.clear();dijit.byId("selectAll").setChecked(false);if(gridMemory.selectedIndex-1>=0){switch(gridMemory.memory[gridMemory.selectedIndex-1].type){case"identify":grid.onStyleRow=styleRowIdentify;break;case"ie":grid.onStyleRow=styleRowIE;break;case"cp":grid.onStyleRow=styleRowCP;break}grid.setStructure(gridMemory.memory[gridMemory.selectedIndex-1].layout);grid.setStore(gridMemory.memory[gridMemory.selectedIndex-1].store);gridExporter.setStructure(gridMemory.memory[gridMemory.selectedIndex-1].layoutExporter);gridExporter.setStore(gridMemory.memory[gridMemory.selectedIndex-1].storeExporter);gridMemory.selectedIndex--}}function nextGrid(){console.log(gridMemory);map.graphics.clear();dijit.byId("selectAll").setChecked(false);if(gridMemory.selectedIndex+1<gridMemory.memory.length){switch(gridMemory.memory[gridMemory.selectedIndex+1].type){case"identify":grid.onStyleRow=styleRowIdentify;break;case"ie":grid.onStyleRow=styleRowIE;break;case"cp":grid.onStyleRow=styleRowCP;break}grid.setStructure(gridMemory.memory[gridMemory.selectedIndex+1].layout);grid.setStore(gridMemory.memory[gridMemory.selectedIndex+1].store);gridExporter.setStructure(gridMemory.memory[gridMemory.selectedIndex+1].layoutExporter);gridExporter.setStore(gridMemory.memory[gridMemory.selectedIndex+1].storeExporter);gridMemory.selectedIndex++}}function selectAllCallback(a){console.log(a);if(a===true){grid.selection.selectRange(0,grid.scroller.rowCount-1)}else{grid.selection.deselectRange(0,grid.scroller.rowCount-1)}}function markSelected(){map.graphics.clear();var b=grid.selection.getSelected();if(b.length!==0){var a=[];dojo.forEach(b,function(c){if(dojo.trim(c.longitud[0].split(":")[1])!=="-80"&&dojo.trim(c.latitud[0].split(":")[1])!=="-10"){a.push([dojo.trim(c.longitud[0].split(":")[1]),dojo.trim(c.latitud[0].split(":")[1])])}});mpJson={points:a,spatialReference:{" wkid":5373}};multipoint=esri.geometry.geographicToWebMercator(new esri.geometry.Multipoint(mpJson));graphic=new esri.Graphic(multipoint,new esri.symbol.PictureMarkerSymbol("images/i_target.png",38,38));map.graphics.add(graphic);map.setExtent(multipoint.getExtent(),true)}}function isDeselectedAll(a){rowsSelected=a.selection.getSelected();if(rowsSelected.length===0){return true}else{return false}}var punto,multipunto,mano_alzada,extension;var drawToolbar;function iniciarIdentify(){require(["esri/toolbars/draw"],function(){drawToolbar=new esri.toolbars.Draw(map)});punto=new dijit.form.ToggleButton({iconClass:"identifyPuntoIcon",label:"Punto"},dojo.byId("punto"));mano_alzada=new dijit.form.ToggleButton({iconClass:"identifyFreeHandIcon",label:"Mano Alzada"},dojo.byId("mano-alzada"));extension=new dijit.form.ToggleButton({iconClass:"identifyExtentIcon",label:"Extensión"},dojo.byId("extension"));dojo.connect(punto,"onClick",function(){if(punto.checked==true){mano_alzada.setChecked(false);extension.setChecked(false);drawToolbar.activate(esri.toolbars.Draw.POINT)}else{drawToolbar.deactivate()}});dojo.connect(mano_alzada,"onClick",function(){if(mano_alzada.checked==true){punto.setChecked(false);extension.setChecked(false);drawToolbar.activate(esri.toolbars.Draw.FREEHAND_POLYGON)}else{drawToolbar.deactivate()}});dojo.connect(extension,"onClick",function(){if(extension.checked==true){punto.setChecked(false);mano_alzada.setChecked(false);drawToolbar.activate(esri.toolbars.Draw.EXTENT)}else{drawToolbar.deactivate()}});dojo.connect(drawToolbar,"onDrawEnd",manejadorDrawEnd)}function manejadorDrawEnd(c){map.graphics.clear();graphic=new esri.Graphic(c,new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,0.5])));map.graphics.add(graphic);activarCargando();var a=new esri.tasks.IdentifyTask("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/cp_ie/MapServer");var b=new esri.tasks.IdentifyParameters();b.geometry=c;b.tolerance=3;b.returnGeometry=false;b.width=map.width;b.height=map.height;b.mapExtent=map.extent;b.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_VISIBLE;identifySelect=dijit.byId("identifySelect");b.layersIds=[4];a.execute(b,identifyCallbackCP,identifyError)}function identifyCallbackCP(a){datos={items:[]};datosExporter={items:[]};layout=[[{name:"Ubigeo",field:"ubigeo"}],[{name:"Nombre del Centro Poblado",field:"nombre_del_centro_poblado"}],[{name:"Código del Centro Poblado",field:"codigo_del_centro_poblado"}],[{name:"Con Institución Educativa",field:"con_ie"}],[{name:"Fuente",field:"fuente_g"}],[{name:"Altitud",field:"altitud"}],[{name:"Latitud",field:"latitud",hidden:true}],[{name:"Longitud",field:"longitud",hidden:true}],[{name:"Enlaces",field:"enlaces"}]];layoutExporter=[[{name:"Ubigeo",field:"ubigeo"}],[{name:"Nombre del Centro Poblado",field:"nombre_del_centro_poblado"}],[{name:"Código del Centro Poblado",field:"codigo_del_centro_poblado"}],[{name:"Con Institución Educativa",field:"con_ie"}],[{name:"Fuente",field:"fuente_g"}],[{name:"Altitud",field:"altitud"}],[{name:"Latitud",field:"latitud"}],[{name:"Longitud",field:"longitud"}]];dojo.forEach(a,function(b){items={ubigeo:"Ubigeo: "+b.feature.attributes.UBIGEO,codigo_del_centro_poblado:"Código del Centro Poblado: "+b.feature.attributes.CODCP,nombre_del_centro_poblado:"Nombre del Centro Poblado: "+b.feature.attributes.NOMCP,con_ie:"¿Tiene IE?: "+b.feature.attributes.CON_IE,fuente_g:"Fuente: "+b.feature.attributes.FUENTE_G,altitud:"Altitud: "+b.feature.attributes.Z,latitud:"Latitud: "+b.feature.attributes.YGD,longitud:"Longitud: "+b.feature.attributes.XGD,enlaces:"<a class='img-enlaces' onclick='hacerZoom("+b.feature.attributes.XGD+","+b.feature.attributes.YGD+");'><img src='images/zoom.png'></a><a class='img-enlaces' onclick='irAIE("+b.feature.attributes.CODCP+")'><img src='images/ficha.png'></a>"};itemsExporter={ubigeo:b.feature.attributes.UBIGEO,codigo_del_centro_poblado:b.feature.attributes.CODCP,nombre_del_centro_poblado:b.feature.attributes.NOMCP,con_ie:b.feature.attributes.CON_IE,fuente_g:b.feature.attributes.FUENTE_G,altitud:b.feature.attributes.Z,latitud:b.feature.attributes.YGD,longitud:b.feature.attributes.XGD};datos.items.push(items);datosExporter.items.push(itemsExporter)});store=new dojo.data.ItemFileWriteStore({data:datos});grid.onStyleRow=styleRowIdentify;grid.setStructure(layout);grid.setStore(store);storeExporter=new dojo.data.ItemFileWriteStore({data:datosExporter});gridExporter.setStructure(layoutExporter);gridExporter.setStore(storeExporter);gridMemory.memory.push({store:store,storeExporter:storeExporter,layout:layout,layoutExporter:layoutExporter,type:"identify"});gridMemory.selectedIndex=gridMemory.memory.length-1;dojo.query(".fm_button").removeClass("fm_button_active");dojo.query(".fm_results_trigger").addClass("fm_button_active");dojo.query(".fm_panel").style("display","none");dojo.query(".fm_results").style("display","block");desactivarCargando()}function identifyCallbackIE(a){datos={items:[]};layout=[[{name:"Código UGEL",field:"codigo_ugel"}],[{name:"Centro Poblado",field:"centro_poblado"}],[{name:"Centro Educativo",field:"centro_educativo"}],[{name:"Estado",field:"estado"}],[{name:"Gestión",field:"gestion"}],[{name:"Niveles",field:"niveles"}],[{name:"Fuente",field:"fuente"}],[{name:"Latitud",field:"latitud",hidden:true}],[{name:"Longitud",field:"longitud",hidden:true}],[{name:"Enlaces",field:"enlaces"}]];datosExporter={items:[]};layoutExporter=[[{name:"Código UGEL",field:"codigo_ugel"},{name:"Centro Poblado",field:"centro_poblado"},{name:"Centro Educativo",field:"centro_educativo"},{name:"Estado",field:"estado"},{name:"Gestión",field:"gestion"},{name:"Niveles",field:"niveles"},{name:"Fuente",field:"fuente"},{name:"Latitud",field:"latitud"},{name:"Longitud",field:"longitud"}]];dojo.forEach(a,function(b){items={codigo_ugel:b.feature.attributes.CODOOII,centro_poblado:b.feature.attributes.ciudad,centro_educativo:b.feature.attributes.CEN_EDU,estado:b.feature.attributes.ESTADO,gestion:b.feature.attributes.GESTION,niveles:b.feature.attributes.NIVELES,fuente:b.feature.attributes.FUENTE,latitud:b.feature.attributes.POINT_Y,longitud:b.feature.attributes.POINT_X,enlaces:"<a class='img-enlaces' onclick='hacerZoom("+b.feature.attributes.POINT_X+","+b.feature.attributes.POINT_Y+");'><img src='images/zoom.png'></a><a class='img-enlaces' onclick='irAFicha("+b.feature.attributes.CODCP+")'><img src='images/ficha.png'></a>"};itemsExporter={codigo_ugel:b.feature.attributes.CODOOII,centro_poblado:b.feature.attributes.ciudad,centro_educativo:b.feature.attributes.CEN_EDU,estado:b.feature.attributes.ESTADO,gestion:b.feature.attributes.GESTION,niveles:b.feature.attributes.NIVELES,fuente:b.feature.attributes.FUENTE,latitud:b.feature.attributes.POINT_Y,longitud:b.feature.attributes.POINT_X};datos.items.push(items);datosExporter.items.push(itemsExporter)});store=new dojo.data.ItemFileWriteStore({data:datos});grid.onStyleRow=styleRowIdentify;grid.setStructure(layout);grid.setStore(store);storeExporter=new dojo.data.ItemFileWriteStore({data:datosExporter});gridExporter.setStructure(layoutExporter);gridExporter.setStore(storeExporter);gridMemory.memory.push({store:store,storeExporter:storeExporter,layout:layout,layoutExporter:layoutExporter,type:"identify"});gridMemory.selectedIndex=gridMemory.memory.length-1;dojo.query(".fm_button").removeClass("fm_button_active");dojo.query(".fm_results_trigger").addClass("fm_button_active");dojo.query(".fm_panel").style("display","none");dojo.query(".fm_results").style("display","block");desactivarCargando()}function identifyError(a){desactivarCargando();alert("La consulta no pudo ser hecha. "+a)}function styleRowIdentify(a){console.log(a);if(a.index%2!==0){a.customStyles+="background: #D7EB66;"}if(a.over){a.customStyles+="background: #7FC5EB"}}dojo.require("esri.map");dojo.require("dojo.json");dojo.require("dojo.data.ItemFileWriteStore");dojo.require("dojo.fx");dojo.require("dojox.grid.EnhancedGrid");dojo.require("dojox.grid.enhanced.plugins.exporter.CSVWriter");dojo.require("dojox.grid.enhanced.plugins.Pagination");dojo.require("dojox.grid.enhanced.plugins.IndirectSelection");dojo.require("dijit.form.Select");dojo.require("dijit.form.TextBox");dojo.require("dijit.form.CheckBox");dojo.require("dijit.form.Button");dojo.require("dijit.Dialog");dojo.require("dijit.form.Form");dojo.require("dijit.layout.TabContainer");dojo.require("dijit.layout.ContentPane");dojo.require("agsjs.dijit.TOC");dojo.require("agsjs.layers.GoogleMapsLayer");var map,initExtent;var basemaps;var identifyTask,identifyParams;var initExtent;var measurement;var cp_ie,limites_politicos,ugel_layer;function init(){var a=dijit.byId("bienvenida_dialog");a.show();initTooltips();initExtent=new esri.geometry.Extent({xmin:-9052049.2735,ymin:-2078120.579,xmax:-7643108.7015,ymax:-10153.778299998492,spatialReference:{wkid:102100}});map=new esri.Map("map",{extent:initExtent,wrapAround180:true,sliderStyle:"small",logo:false});require(["esri/layers/osm","esri/dijit/OverviewMap"],function(){var b=createBasemapGallery(map,"basemapList");cp_ie=new esri.layers.ArcGISTiledMapServiceLayer("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/cp_ie/MapServer");limites_politicos=new esri.layers.ArcGISTiledMapServiceLayer("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer");ugel_layer=new esri.layers.ArcGISTiledMapServiceLayer("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_ugel/MapServer");var e=[];e.push({layer:cp_ie,title:"Centros Poblados e IEs"});e.push({layer:limites_politicos,title:"Límites Políticos"});e.push({layer:ugel_layer,title:"UGEL"});dojo.connect(map,"onLayersAddResult",function(f){var g=new agsjs.dijit.TOC({map:map,layerInfos:e},"legendDiv");g.startup()});ugel_layer.setVisibility(false);map.addLayers([cp_ie,limites_politicos,ugel_layer]);var d=new esri.layers.OpenStreetMapLayer();var c=new esri.dijit.OverviewMap({map:map,baseLayer:d,height:0.25*map.height,width:0.25*map.width});c.startup()});llenarFormulario();dojo.connect(dijit.byId("searchForm"),"onSubmit",busqueda);dojo.connect(window,"onresize",function(){if(map){map.resize();map.setExtent(map.extent)}});iniciarGrid();iniciarIdentify();iniciarNavegacion();onMapLoaded();desactivarCargando();dojo.style("cargando","opacity",0.5)}function createBasemapGallery(b,c){basemaps=[];basemaps.push(new esri.dijit.Basemap({layers:[new esri.dijit.BasemapLayer({type:"GoogleMapsRoad"})],title:"Google Road",id:"GoogleRoad",thumbnailUrl:dojo.moduleUrl("agsjs.dijit","images/googleroad.png")}));basemaps.push(new esri.dijit.Basemap({layers:[new esri.dijit.BasemapLayer({type:"GoogleMapsSatellite"})],title:"Google Satellite",id:"GoogleSatellite",thumbnailUrl:dojo.moduleUrl("agsjs.dijit","images/googlesatellite.png")}));basemaps.push(new esri.dijit.Basemap({layers:[new esri.dijit.BasemapLayer({type:"GoogleMapsHybrid"})],title:"Google Hybrid",id:"GoogleHybrid",thumbnailUrl:dojo.moduleUrl("agsjs.dijit","images/googlehybrid.png")}));basemaps.push(new esri.dijit.Basemap({layers:[new esri.dijit.BasemapLayer({type:"OpenStreetMap"})],title:"OpenStreet",id:"OpenStreetMap",thumbnailUrl:"images/bm-street.jpg"}));var a=new esri.dijit.BasemapGallery({showArcGISBasemaps:false,basemaps:basemaps,google:{apiOptions:{v:"3.6"},mapOptions:{streetViewControl:false}},map:b},c);a.startup();a.select("GoogleHybrid");return a}function onMapLoaded(){console.log("map loaded enter");require(["esri/dijit/Scalebar"],function(){var a=new esri.dijit.Scalebar({map:map,attachTo:"bottom-left",scalebarUnit:"metric"})});require(["esri/dijit/Measurement"],function(){measurement=new esri.dijit.Measurement({map:map,defaultAreaUnit:esri.Units.SQUARE_KILOMETERS,defaultLengthUnit:esri.Units.KILOMETERS},dojo.byId("measurementDiv"));measurement.startup()});console.log(res);dojo.connect(map,"onMouseMove",res.showCoords);res.showCoords(map.extent.getCenter());dojo.connect(map,"onExtentChange",onMapExtentChange);onMapExtentChange();console.log("map loaded exit")}function onMapExtentChange(){var a=Math.round(esri.geometry.getScale(map));if(a>999&&a<=999999){a=Math.round(a/1000)+" <b>K</b>"}else{if(a>999999){a=Math.round(a/1000000)+" <b>M</b>"}else{if(a>0&&a<=999){a=Math.round(a)+" <b>Ft</b>"}}}res.updateScaleInfo(a,map.getLevel())}function activarCargando(){dojo.style("cargando","display","block")}function desactivarCargando(){dojo.style("cargando","display","none")}window.onorientationchange=function(){if(map){map.resize()}else{console.log("map not found")}};window.onresize=function(){if(map){map.resize()}else{console.log("map not found")}};dojo.addOnLoad(init);function iniciarNavegacion(){require(["esri/toolbars/Navigation"],function(){navToolbar=new esri.toolbars.Navigation(map);fm_prevExtent_trigger=dojo.query(".fm_prevExtent_trigger")[0];fm_nextExtent_trigger=dojo.query(".fm_nextExtent_trigger")[0];fm_fullExtent_trigger=dojo.query(".fm_fullExtent_trigger")[0];dojo.connect(fm_prevExtent_trigger,"onclick",function(){if(!navToolbar.isFirstExtent()){navToolbar.zoomToPrevExtent()}});dojo.connect(fm_nextExtent_trigger,"onclick",function(){if(!navToolbar.isLastExtent()){navToolbar.zoomToNextExtent()}});dojo.connect(fm_fullExtent_trigger,"onclick",function(){map.setExtent(initExtent)})})}var res;function responsive(){var a=this;a.mobile=false;a.collapse=false;this.setResponsive=function(){a.jRes=jRespond([{label:"mobile",enter:0,exit:999},{label:"desktop",enter:1000,exit:100000}]);a.jRes.addFunc({breakpoint:"desktop",enter:function(){$(".fm_left_content").show();$(".fm_right_content").show();$(".fm_close.fm_hide").hide();a.collapse=false;console.log(">>> desktop enter <<<")},exit:function(){$(".fm_close.fm_hide").show();a.collapse=true;console.log("<<< desktop exit >>>")}});a.jRes.addFunc({breakpoint:"mobile",enter:function(){a.mobile=true;a.collapse=true;a.setActiveTab(null);$(".fm_show").hide();$(".fm_left_content").hide();$(".fm_right_content").hide();console.log(">>> mobile enter <<<")},exit:function(){a.mobile=false;a.collapse=false;$(".fm_show").show();$(".fm_left_content").show();$(".fm_right_content").show();console.log("<<< mobile exit >>>")}})};this.setBindings=function(){$(".fm_find_me").click(function(){if($(this).hasClass("fm_on")){$(this).removeClass("fm_on")}else{res.findMe();$(this).addClass("fm_on")}});$(".fm_close").click(function(){if($(this).hasClass("fm_hide")){$(this).hide()}$(this).parent().hide();if(a.collapse){a.setActiveTab(null)}if($(this).parent().hasClass("fm_measurement")){measurement.setTool("area",false);measurement.setTool("distance",false);measurement.setTool("location",false);measurement.clearResult()}if($(this).parent().hasClass("fm_identify")){punto.setChecked(false);mano_alzada.setChecked(false);extension.setChecked(false);drawToolbar.deactivate();map.graphics.clear()}if($(this).parent().hasClass("fm_print")){destruirImpresion()}});$(".fm_basemap_trigger").click(function(b){b.preventDefault();if(a.collapse){a.setActiveTab(null);$(".fm_right_content").hide()}measurement.setTool("area",false);measurement.setTool("distance",false);measurement.setTool("location",false);measurement.clearResult();punto.setChecked(false);mano_alzada.setChecked(false);extension.setChecked(false);drawToolbar.deactivate();$(".fm_measurement").hide();$(".fm_identify").hide();$(".fm_navegacion").hide();$(".fm_print").hide();$(".fm_basemap_list").toggle();return false});$(".fm_measure_trigger").click(function(b){b.preventDefault();if(a.collapse){a.setActiveTab(null);$(".fm_right_content").hide()}punto.setChecked(false);mano_alzada.setChecked(false);extension.setChecked(false);drawToolbar.deactivate();$(".fm_basemap_list").hide();$(".fm_identify").hide();$(".fm_navegacion").hide();$(".fm_print").hide();$(".fm_measurement").toggle();return false});$(".fm_identify_trigger").click(function(b){b.preventDefault();if(a.collapse){a.setActiveTab(null);$(".fm_right_content").hide()}measurement.setTool("area",false);measurement.setTool("distance",false);measurement.setTool("location",false);measurement.clearResult();$(".fm_measurement").hide();$(".fm_basemap_list").hide();$(".fm_navegacion").hide();$(".fm_print").hide();$(".fm_identify").toggle();return false});$(".fm_navegacion_trigger").click(function(b){b.preventDefault();if(a.collapse){a.setActiveTab(null);$(".fm_right_content").hide()}measurement.setTool("area",false);measurement.setTool("distance",false);measurement.setTool("location",false);measurement.clearResult();punto.setChecked(false);mano_alzada.setChecked(false);extension.setChecked(false);drawToolbar.deactivate();$(".fm_measurement").hide();$(".fm_basemap_list").hide();$(".fm_navegacion").toggle();$(".fm_print").hide();$(".fm_identify").hide();return false});$(".fm_print_trigger").click(function(b){b.preventDefault();if(a.collapse){a.setActiveTab(null);$(".fm_right_content").hide()}measurement.setTool("area",false);measurement.setTool("distance",false);measurement.setTool("location",false);measurement.clearResult();punto.setChecked(false);mano_alzada.setChecked(false);extension.setChecked(false);drawToolbar.deactivate();$(".fm_measurement").hide();$(".fm_basemap_list").hide();$(".fm_navegacion").hide();$(".fm_identify").hide();$(".fm_print").toggle();iniciarImpresion();return false});$(".fm_share_trigger").click(function(){a.generateEmbedCode()});$(".fm_trigger").click(function(c){c.preventDefault();a.setActiveTab(this);var b=$(this).data("panel");a.showPanel(b)})};this.setActiveTab=function(b){$(".fm_button").each(function(){$(this).removeClass("fm_button_active")});if(b){$(b).addClass("fm_button_active")}};this.showPanel=function(b){$(".fm_right_content").show();if(a.collapse){$(".fm_right_content").find(".fm_close").show()}$(".fm_panel").hide();b="."+b;$(b).show()};this.populateMapInfo=function(b){document.title=b.title;$(".fm_title_bar").html(b.title);var c="Map Creator: "+b.owner;$(".fm_description").html(b.description+"<p>"+c+"</p>")};this.showCoords=function(b){try{var d=esri.geometry.webMercatorToGeographic(b.mapPoint||b);if(d===null||d===undefined){return}var c="<b>Lat:</b> "+Math.abs(d.y.toFixed(2))+"°"+((d.y<0)?"S":"N")+"&nbsp;&nbsp;<b>Lon:</b> "+Math.abs(d.x.toFixed(2))+"°"+((d.x<0)?"W":"E");$(".fm_coordsinfo").html(c)}catch(f){console.log(f)}};this.updateScaleInfo=function(b,c){$(".fm_scaleinfo").html("<b>Escala:</b> 1 <b>:</b> "+b);$(".fm_zoomlevelinfo").html("<b>Zoom:</b> "+c)};this.embedSetup=function(){console.log("styling page for embeding");$("header").hide();$("footer").hide();if(a.mobile){$(".fm_container_main").css("top","0px")}else{$("nav").css("top","0px");$(".fm_container_main").css("bottom","0px").css("top","2.2em")}};this.generateEmbedCode=function(){var c=window.location.href;var b="<iframe src='"+c+"' style='border:0px  none;' name='responsiveViewer' scrolling='no' frameborder='0' marginheight='0px' marginwidth='0px' height='60px' width='468px'></iframe>";$(".fm_embed_code").html(b)};this.showLoading=function(){console.log("show loading")};this.hideLoading=function(){console.log("hide loading")};this.findMe=function(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(b){if(map&&b&&b.coords){var c=esri.geometry.geographicToWebMercator(new esri.geometry.Point(b.coords.longitude,b.coords.latitude));if(b.accuracy<10000){map.centerAndZoom(c,16)}else{map.centerAndZoom(c,14)}var d=new esri.Graphic(c,new esri.symbol.PictureMarkerSymbol("images/i_target.png",38,38));a.animateMapSymbol(d)}},function(b){console.log(b);$(".fm_find_me").removeClass("fm_on")})}};this.animateMapSymbol=function(f){var d=1;var c=f.symbol.color;var e=f.geometry.type;var h=f.symbol;if(e==="extent"){h.outline.color.a=d;h.color.a=0}else{h.color.a=d}map.graphics.add(f);var b=setInterval(function(){if(e!=="extent"){h.setColor(new dojo.Color([c.r,c.g,c.b,d]))}if(h.outline){var g=h.outline.color;h.outline.setColor(new dojo.Color([g.r,g.g,g.b,d]))}f.setSymbol(h);if(d<0.01){clearInterval(b);map.graphics.remove(f)}d-=0.01},20)};this.initApp=function(){a.setBindings();a.generateEmbedCode();a.setResponsive();$(".fm_measurement").draggable({cursor:"move"});$(".fm_identify").draggable({cursor:"move"});$(".fm_navegacion").draggable({cursor:"move"});$(".fm_basemap_list").draggable({cursor:"move"});$(".fm_find").show();if(!(a.collapse)){a.setActiveTab(".fm_find_trigger")}}}$(document).ready(function(){res=new responsive();res.initApp()});var print_map,print_basemapGallery,print_legend;var print_centros_poblados,print_limites_politicos;function iniciarImpresion(){if(dojo.isFF){print_dialog=dijit.byId("print_dialog");print_dialog.show()}print_map=new esri.Map("print_map",{extent:initExtent,slider:false,logo:false});require(["esri/dijit/Scalebar"],function(){print_scalebar=new esri.dijit.Scalebar({map:print_map,scalebarUnit:"metric",attachTo:"bottom-left"})});print_basemapGallery=createBasemapGallery(print_map,"");print_centros_poblados=new esri.layers.ArcGISTiledMapServiceLayer("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/cp_ie/MapServer");print_limites_politicos=new esri.layers.ArcGISTiledMapServiceLayer("http://escale.minedu.gob.pe/medgis/rest/services/carto_base/lim_pol/MapServer");print_layerInfos=[];print_layerInfos.push({layer:print_centros_poblados,title:"Centros Poblados"});print_layerInfos.push({layer:print_limites_politicos,title:"Límites Políticos"});dojo.connect(print_map,"onLayersAddResult",function(a){require(["esri/dijit/Legend"],function(){print_legend=new esri.dijit.Legend({map:print_map,layerInfos:print_layerInfos},"print_legend");print_legend.startup();print_map.setExtent(map.extent)})});print_map.addLayers([print_centros_poblados,print_limites_politicos]);activar_print_centros_poblados=dojo.byId("activar_print_centros_poblados");activar_print_limites_politicos=dojo.byId("activar_print_limites_politicos");dojo.connect(activar_print_centros_poblados,"onclick",function(){if(activar_print_centros_poblados.checked){print_centros_poblados.show()}else{print_centros_poblados.hide()}});dojo.connect(activar_print_limites_politicos,"onclick",function(){if(activar_print_limites_politicos.checked){print_limites_politicos.show()}else{print_limites_politicos.hide()}});print_map_size=dijit.byId("print_map_size");page_size=dojo.byId("page_size");console.log(page_size);dojo.connect(print_map_size,"onChange",function(a){console.log(a);switch(a){case"a4_apaisada":dojo.style("print_area",{width:"212mm",height:"150mm"});dojo.style("print_map",{width:"65%",height:"90%","float":"left"});dojo.empty(page_size);page_size.innerHTML="@page{size:A4 landscape;margin: 12.7mm;}";print_map.resize(true);print_map.setExtent(map.extent);break;case"a4_normal":dojo.style("print_area",{width:"150mm",height:"212mm"});dojo.style("print_map",{width:"100%",height:"40%","float":"none"});dojo.empty(page_size);page_size.innerHTML="@page{size:A4;margin:12.7mm;}";print_map.resize(true);print_map.setExtent(map.extent);break;case"a3_apaisada":dojo.style("print_area",{width:"325mm",height:"230mm"});dojo.style("print_map",{width:"60%",height:"90%","float":"left"});dojo.empty(page_size);page_size.innerHTML="@page{size:A3 landscape;margin:12.7mm;}";print_map.resize(true);print_map.setExtent(map.extent);break;case"a3_normal":dojo.style("print_area",{width:"230mm",height:"325mm"});dojo.style("print_map",{width:"100%",height:"60%","float":"none"});dojo.empty(page_size);page_size.innerHTML="@page{size:A3;margin:12.7mm;}";print_map.resize(true);print_map.setExtent(map.extent);break}});map_title=dojo.byId("map_title");map_subtitle=dojo.byId("map_subtitle");print_tile=dojo.byId("print_title");print_subtitle=dojo.byId("print_subtitle");dojo.connect(map_title,"onkeyup",function(){dojo.html.set(print_title,map_title.value)});dojo.connect(map_subtitle,"onkeyup",function(){dojo.html.set(print_subtitle,map_subtitle.value)});dojo.connect(dijit.byId("imprimir"),"onClick",function(){window.print()})}function destruirImpresion(){print_basemapGallery.destroy();print_legend.destroy();print_map.destroy();dojo.create("div",{id:"print_basemapGallery"},dojo.byId("print_basemapGallery_container"));dojo.create("div",{id:"print_legend"},dojo.byId("print_legend_container"))}function initTooltips(){require(["dijit/Tooltip"],function(){new dijit.Tooltip({connectId:dojo.query(".fm_basemap_trigger"),label:"Mapas Base",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_measure_trigger"),label:"Medición",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_identify_trigger"),label:"Identificador",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_prevExtent_trigger"),label:"Extensión previa",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_nextExtent_trigger"),label:"Extensión siguiente",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_fullExtent_trigger"),label:"Extensión total",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_print_trigger"),label:"Impresión",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_legend_trigger"),label:"Leyenda y Selección de Capas",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_find_trigger"),label:"Búsqueda",position:["below","above"]});new dijit.Tooltip({connectId:dojo.query(".fm_results_trigger"),label:"Resultados",position:["below","above"]})})};